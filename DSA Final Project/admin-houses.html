<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Houses - HomeAlloc Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Lato', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .admin-container {
            display: flex;
            width: 95%;
            max-width: 1400px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .sidebar-header h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            margin-bottom: 10px;
            color: #63b3ed;
        }
        
        .admin-name {
            background: rgba(99, 179, 237, 0.2);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .sidebar-nav ul {
            list-style: none;
            flex-grow: 1;
        }
        
        .sidebar-nav li {
            margin-bottom: 15px;
        }
        
        .sidebar-nav a {
            color: #cbd5e0;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .sidebar-nav a:hover, .sidebar-nav a.active {
            background: rgba(99, 179, 237, 0.2);
            color: #63b3ed;
            transform: translateX(5px);
        }
        
        .logout-btn {
            color: #fc8181 !important;
            margin-top: 20px;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f7fafc;
        }
        
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .main-header h1 {
            font-family: 'Montserrat', sans-serif;
            color: #2d3748;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .add-btn {
            background: #48bb78;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
        }
        
        .refresh-btn, select {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        select {
            min-width: 150px;
        }
        
        .houses-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .section-header h3 {
            color: #2d3748;
            font-size: 20px;
        }
        
        .section-actions input {
            padding: 8px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            width: 250px;
            outline: none;
        }
        
        .houses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .house-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .house-card:hover {
            border-color: #4299e1;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .house-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .house-id {
            font-weight: bold;
            font-size: 18px;
            color: #2d3748;
        }
        
        .house-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-available { background: #c6f6d5; color: #276749; }
        .status-occupied { background: #bee3f8; color: #2c5282; }
        .status-maintenance { background: #feebc8; color: #c05621; }
        
        .house-details p {
            margin-bottom: 8px;
            color: #4a5568;
        }
        
        .house-specs {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .house-specs span {
            background: #f7fafc;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .house-occupant, .house-facilities {
            background: #edf2f7;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .house-actions {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .house-actions .action-btn {
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .edit { background: #feebc8; color: #c05621; }
        .view { background: #e2e8f0; color: #4a5568; }
        .allocate { background: #4299e1; color: white; }
        .vacate { background: #f56565; color: white; }
        .delete { background: #fed7d7; color: #c53030; }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
        }
        
        .add-btn-large {
            background: #48bb78;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 20px;
        }
        
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            transition: transform 0.3s;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
        }
        
        .stat-item h4 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .stat-item p {
            font-size: 32px;
            font-weight: bold;
            color: #2d3748;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .modal-header h3 {
            color: #2d3748;
            font-size: 22px;
        }
        
        .close-btn {
            background: #fed7d7;
            color: #c53030;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        form {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #4299e1;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .submit-btn {
            background: #48bb78;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
        }
        
        .cancel-btn {
            background: #fed7d7;
            color: #c53030;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
        }
        
        @media (max-width: 1024px) {
            .admin-container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                flex-direction: row;
                padding: 15px;
            }
            
            .sidebar-nav ul {
                display: flex;
                gap: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .main-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .section-actions input {
                width: 100%;
            }
            
            .houses-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">üè†</div>
                <h2>HomeAlloc Admin</h2>
                <p class="admin-name">üë§ {{ session.get('admin_username', 'Admin') }}</p>
            </div>
            
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="/admin/dashboard">üìä Dashboard</a></li>
                    <li><a href="/admin/applications">üìã Applications</a></li>
                    <li><a href="/admin/houses" class="active">üè† Houses</a></li>
                    <li><a href="/admin/allocate">‚ö° Allocate</a></li>
                    <li><a href="/admin/logout" class="logout-btn">üö™ Logout</a></li>
                </ul>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <h1>üè† Manage Houses</h1>
                <div class="header-actions">
                    <button onclick="showAddHouseModal()" class="add-btn">‚ûï Add New House</button>
                    <button onclick="location.reload()" class="refresh-btn">üîÑ Refresh</button>
                    <select id="statusFilter" onchange="filterHouses()">
                        <option value="all">All Houses</option>
                        <option value="available">‚úÖ Available</option>
                        <option value="occupied">üë§ Occupied</option>
                        <option value="maintenance">üîß Maintenance</option>
                    </select>
                </div>
            </header>
            
            <!-- Houses Grid -->
            <div class="houses-section">
                <div class="section-header">
                    <h3>Available Houses ({{ houses|selectattr('status', 'equalto', 'available')|list|length }})</h3>
                    <div class="section-actions">
                        <input type="text" id="searchHouses" placeholder="Search houses..." onkeyup="searchHouses()">
                    </div>
                </div>
                
                {% if houses %}
                <div class="houses-grid" id="housesGrid">
                    {% for house in houses %}
                    <div class="house-card" id="house-{{ house.id }}">
                        <div class="house-header">
                            <span class="house-id">{{ house.house_id }}</span>
                            <span class="house-status status-{{ house.status }}">
                                {{ house.status|title }}
                            </span>
                        </div>
                        
                        <div class="house-details">
                            <p class="house-address">üìç {{ house.address }}</p>
                            <p class="house-type">üèòÔ∏è {{ house.house_type|title }}</p>
                            
                            <div class="house-specs">
                                <span>üõèÔ∏è {{ house.bedrooms }} BR</span>
                                <span>üìè {{ house.size }} sqft</span>
                            </div>
                            
                            {% if house.current_occupant_id %}
                            <div class="house-occupant">
                                <p>üë§ Occupied by: 
                                    {% if house.application %}
                                    {{ house.application.name }}
                                    {% else %}
                                    Occupant {{ house.current_occupant_id }}
                                    {% endif %}
                                </p>
                            </div>
                            {% endif %}
                            
                            {% if house.facilities %}
                            <div class="house-facilities">
                                <p>üèÜ Facilities: {{ house.facilities }}</p>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="house-actions">
                            <button onclick="editHouse({{ house.id }})" class="action-btn edit">‚úèÔ∏è Edit</button>
                            <button onclick="viewHouseDetails({{ house.id }})" class="action-btn view">üëÅÔ∏è View</button>
                            
                            {% if house.status == 'available' %}
                            <button onclick="allocateHouse({{ house.id }})" class="action-btn allocate">‚ö° Allocate</button>
                            {% endif %}
                            
                            {% if house.status == 'occupied' %}
                            <button onclick="vacateHouse({{ house.id }})" class="action-btn vacate">üö™ Vacate</button>
                            {% endif %}
                            
                            <button onclick="deleteHouse({{ house.id }})" class="action-btn delete">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <h3>üèöÔ∏è No Houses Added</h3>
                    <p>No houses have been added to the system yet.</p>
                    <button onclick="showAddHouseModal()" class="add-btn-large">‚ûï Add First House</button>
                </div>
                {% endif %}
            </div>
            
            <!-- House Stats -->
            <div class="stats-summary">
                <div class="stat-item">
                    <h4>‚úÖ Available</h4>
                    <p>{{ houses|selectattr('status', 'equalto', 'available')|list|length }}</p>
                </div>
                <div class="stat-item">
                    <h4>üë§ Occupied</h4>
                    <p>{{ houses|selectattr('status', 'equalto', 'occupied')|list|length }}</p>
                </div>
                <div class="stat-item">
                    <h4>üîß Maintenance</h4>
                    <p>{{ houses|selectattr('status', 'equalto', 'maintenance')|list|length }}</p>
                </div>
                <div class="stat-item">
                    <h4>üìä Total Houses</h4>
                    <p>{{ houses|length }}</p>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Add House Modal -->
    <div id="addHouseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Add New House</h3>
                <button onclick="closeAddHouseModal()" class="close-btn">√ó</button>
            </div>
            
            <form id="addHouseForm" onsubmit="return addNewHouse(event)">
                <div class="form-group">
                    <label for="house_id">House ID *</label>
                    <input type="text" id="house_id" name="house_id" placeholder="e.g., H-101" required>
                </div>
                
                <div class="form-group">
                    <label for="address">Address *</label>
                    <textarea id="address" name="address" placeholder="Full address of the house" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="type">House Type *</label>
                        <select id="type" name="type" required>
                            <option value="">Select type</option>
                            <option value="apartment">Apartment</option>
                            <option value="house">House</option>
                            <option value="duplex">Duplex</option>
                            <option value="studio">Studio</option>
                            <option value="villa">Villa</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="bedrooms">Bedrooms *</label>
                        <input type="number" id="bedrooms" name="bedrooms" min="1" max="10" value="2" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="size">Size (sqft) *</label>
                        <input type="number" id="size" name="size" min="100" step="50" value="1000" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="facilities">Facilities</label>
                    <input type="text" id="facilities" name="facilities" placeholder="Parking, Security, Water, Electricity">
                </div>
                
                <div class="form-group">
                    <label for="status">Initial Status</label>
                    <select id="status" name="status">
                        <option value="available">‚úÖ Available</option>
                        <option value="maintenance">üîß Under Maintenance</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="submit-btn">‚ûï Add House</button>
                    <button type="button" onclick="closeAddHouseModal()" class="cancel-btn">‚ùå Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Modal Functions
        function showAddHouseModal() {
            document.getElementById('addHouseModal').style.display = 'flex';
            document.getElementById('house_id').focus();
        }
        
        function closeAddHouseModal() {
            document.getElementById('addHouseModal').style.display = 'none';
            document.getElementById('addHouseForm').reset();
        }
        
        // Add new house
        function addNewHouse(event) {
            event.preventDefault();
            
            const formData = new FormData(document.getElementById('addHouseForm'));
            
            fetch('/admin/api/add-house', {
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ ' + data.message);
                    closeAddHouseModal();
                    location.reload();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            })
            .catch(error => {
                alert('‚ùå Network error: ' + error);
            });
            
            return false;
        }
        
        // House Actions
        function viewHouseDetails(houseId) {
            fetch(`/api/house/${houseId}`)
                .then(res => res.json())
                .then(data => {
                    if (data.error) {
                        alert('Error: ' + data.error);
                        return;
                    }
                    
                    const details = `
üè† HOUSE DETAILS
================
ID: ${data.house_id}
Address: ${data.address}
Type: ${data.house_type}
Bedrooms: ${data.bedrooms}
Size: ${data.size} sqft
Status: ${data.status}
Facilities: ${data.facilities || 'N/A'}
Added: ${data.added_date}
                    `;
                    
                    if (data.current_occupant_id) {
                        details += `\nüë§ Occupant ID: ${data.current_occupant_id}`;
                    }
                    
                    alert(details);
                });
        }
        
        function editHouse(houseId) {
            alert('‚úèÔ∏è Edit house feature would open an edit form.');
            // In real app: Open edit modal with house data
        }
        
        function allocateHouse(houseId) {
            window.location.href = `/admin/allocate?house=${houseId}`;
        }
        
        function vacateHouse(houseId) {
            if (confirm('Vacate this house? The current occupant will be removed.')) {
                fetch(`/admin/api/vacate-house/${houseId}`, {
                    method: 'POST'
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('‚úÖ House vacated!');
                        location.reload();
                    } else {
                        alert('‚ùå Error: ' + data.error);
                    }
                });
            }
        }
        
        function deleteHouse(houseId) {
            if (confirm('‚ö†Ô∏è Delete this house? This action cannot be undone!')) {
                fetch(`/admin/api/delete-house/${houseId}`, {
                    method: 'POST'
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('üóëÔ∏è House deleted!');
                        document.getElementById(`house-${houseId}`).remove();
                    } else {
                        alert('‚ùå Error: ' + data.error);
                    }
                });
            }
        }
        
        // Search and Filter
        function searchHouses() {
            const searchTerm = document.getElementById('searchHouses').value.toLowerCase();
            const houseCards = document.querySelectorAll('.house-card');
            
            houseCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        function filterHouses() {
            const filter = document.getElementById('statusFilter').value;
            const houseCards = document.querySelectorAll('.house-card');
            
            houseCards.forEach(card => {
                if (filter === 'all') {
                    card.style.display = '';
                    return;
                }
                
                const statusBadge = card.querySelector('.house-status');
                if (statusBadge && statusBadge.classList.contains(`status-${filter}`)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('addHouseModal');
            if (event.target == modal) {
                closeAddHouseModal();
            }
        }
    </script>
</body>
</html>